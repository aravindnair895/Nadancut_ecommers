
<!doctype html>
<html lang="en">
{% load static %}

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="{% static 'img/favicon.ico' %}" rel="icon">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Profile</title>

    <style>
/* Primary theme colors */
:root{
  --red:#eb1616;
  --dark:#111111;
  --light:#f5f5f5;
}

/* Sidebar active item */
.list-group-item.active {
    background: var(--red) !important;
    color: white !important;
}

/* Profile image border */
.bg-warning {
    background: var(--red) !important;
}

/* Cards */
.card {
    background: #1a1a1a;
    color: #f5f5f5;
    border: 1px solid #333;
}

/* Headings */
h4,h5,h6 {
    color: var(--red);
}

/* Buttons */
.button_div button,
.add_address_button {
    background: var(--red);
    border: 1px solid var(--red);
    color: white;
}

.button_div button:hover,
.add_address_button:hover {
    background: black;
    border-color: black;
}

/* Modal */
.modal-content {
    background-color: #1a1a1a;
    color: white;
    border: 1px solid #444;
}

/* Inputs */
input, textarea, select {
    background: #111;
    color: white;
    border: 1px solid #444;
}

input:focus, textarea:focus, select:focus {
    border-color: var(--red);
    outline: none;
}

/* Table */
.table {
    color: white;
}

.table thead {
    background: black;
    color: var(--red);
}

/* Badges */
.badge-warning {
    background: var(--red);
    color: white;
}

.badge-success {
    background: black;
    color: var(--red);
    border: 1px solid var(--red);
}

/* Timeline */
.timeline li.active h6 {
    color: var(--red);
}

/* Links */
a {
    color: #ccc;
}

a:hover {
    color: var(--red);
}
/* body */
body {
    background: #191c24 !important;
}

/* Section background */
section {
    background: #191c24 !important;
}

/* Bootstrap container override */
.container,
.main-body {
    background: transparent !important;
}

/* Remove white from row spacing */
.row {
    background: transparent !important;
}

/* If any wrapper is white */
div {
    background-color: inherit;
}

#stars span {
  font-size: 28px;
  cursor: pointer;
  color: gray;
}
#stars span.active {
  color: gold;
}

</style>

</head>

<body>
    <section class="my-5">
        <div class="container">
            <div class="main-body">
                <div class="row">
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex flex-column align-items-center text-center">
                                    <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="User"
                                        class="rounded-circle p-1 bg-warning" width="110">
                                    <div class="mt-3">
                                        <h4>{{user.username}}</h4>
                                        <p class="text-secondary mb-1">{{user.phone}}</p>
                                        <p class="text-muted font-size-sm">{{user.email}}</p>

                                    </div>
                                </div>
                                <div class="list-group list-group-flush text-center mt-4">
                                    <a href="#" class="list-group-item list-group-item-action border-0 " onclick="showProfileDetails()">
                                        Profile Information
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action border-0" onclick="showOrderDetails()">Orders</a>

                                    <a href="#" class="list-group-item list-group-item-action border-0"
                                       onclick="showAccountDetails()">
                                        Account Details
                                    </a>

                                    <a href="#" class="list-group-item list-group-item-action border-0 active"
                                        onclick="showAddressBook()">
                                        Address Book
                                    </a>
                                    <a href="/log_out" class="list-group-item list-group-item-action border-0">Logout</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <div id="profileDetails" class="card" style="display: none;">
                        <div class="card-body">
                            <div class="profile-info">
                                <h5>Profile Information</h5>
                                <p><strong>Name:</strong>{{user.username}}</p>
                                <p><strong>Email Address:</strong> {{user.email}}</p>
                                <p><strong>Contact:</strong> {{user.phone}}</p>


                            </div>
                        </div>
                    </div>

                        <div  id="orderDetails" class="order_card">
                            <div class="card mt-4">
                                <div class="card-body p-0 table-responsive">
                                    <h4 class="p-3 mb-0">Product Description</h4>
                                    {% if checkout %}
                                    <table class="table mb-0">
                                        <thead>
                                        <tr>
                                            <th scope="col">Order</th>
                                            <th scope="col">Date</th>
                                            <th scope="col">Status</th>
                                            <th scope="col">Total</th>
                                            <th scope="col">Products</th>
                                            <th scope="col">Products image</th>
                                            <th scope="col">Products quantity</th>
                                            <th scope="col">Review</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for i in checkout %}
                                        <tr>
                                            <td>{{i.buy.orderID}}</td>
                                            <td>{{i.buy.date}}</td>
                                            <td><span class="badge badge-warning">{{i.buy.order_status}}</span></td>
                                            <td><strong>â‚¹{{i.buy.disc_price}}</strong></td>
                                            <td>{{i.product.prod}}</td>
                                            <td><img src="{{i.product.image.url}}" style="width:60px; height:60px;"></td>
                                            <td>{{i.quantity}}</td>
                                            <td>
                                              <button class="btn btn-sm btn-danger" onclick="openReviewModal({{i.product.id}})">
                                                Add Review
                                              </button>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                        {% for b in buy %}
                                          {% if not b.tablecheckoutlist_set.all %}
                                          <tr>
                                            <td>{{ b.orderID }}</td>
                                            <td>{{ b.date }}</td>
                                            <td><span class="badge badge-warning">{{ b.order_status }}</span></td>
                                            <td><strong>â‚¹{{ b.disc_price }}</strong></td>
                                            <td>{{ b.product.prod }}</td>
                                            <td><img src="{{ b.product.image.url }}" style="width:60px;height:60px;"></td>
                                            <td>{{ b.quantity }}</td>
                                            <td>
                                              <button class="btn btn-sm btn-danger"
                                                      onclick="openReviewModal({{ b.product.id }})">
                                                Add Review
                                              </button>
                                            </td>
                                          </tr>
                                          {% endif %}
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                    {% else %}
                                    <div class="alert alert-info text-center py-4 mt-4">
                                      <h4 class="alert-heading">ðŸ›’ No Orders Yet!</h4>
                                      <p class="mb-3">
                                        You havenâ€™t placed any orders so far.
                                        Start exploring and find something youâ€™ll love!
                                      </p>
                                      <a href="/shop/" class="btn btn-primary">Start Shopping</a>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                        </div>

                        <div id="accountDetails" class="card" style="display:none;">
                          <div class="card-body">
                            <h5>Account Details</h5>

                            <form method="post" action="/update_account/">
                              {% csrf_token %}

                              <label>Email</label>
                              <input type="email" name="email" value="{{ user.email }}" required><br><br>

                              <label>New Password</label>
                              <input type="password" name="password"><br><br>

                              <label>Confirm Password</label>
                              <input type="password" name="cpassword"><br><br>

                              <div class="col-12 d-flex button_div">
                              <button type="submit">Update</button>
                              </div>
                            </form>
                          </div>
                        </div>



                        <div id="addressBook" class="card" style="display: none;">
                        <div class="card-body">
                            <h5>Address Book</h5>
                            <button class="add_address_button" onclick="showAddAddressModal()">Add Address</button><br><br>

                            <div id="addressList">
                                <div class="row g-3">
                                  {% for i in address %}
                                  <div class="col-12 col-md-6 col-lg-4">   <!-- THIS is the wrapper -->

                                    <label
                                      for="address{{ i.id }}"
                                      class="position-relative d-flex gap-3 p-3 border rounded w-100 cursor-pointer">

                                      <input
                                        type="radio"
                                        name="address_id"
                                        value="{{ i.id }}"
                                        id="address{{ i.id }}"
                                        class="position-absolute"
                                        style="top:0.75rem; right:0.75rem;"
                                        {% if forloop.first %}checked{% endif %}>

                                      <div>
                                        <div class="fw-bold">{{ i.fname }} {{ i.sname }}</div>
                                        <div>{{ i.address }}</div>
                                        <div>{{ i.phone }}</div>
                                        {% if i.landmark %}<div>{{ i.landmark }}</div>{% endif %}
                                        <div>{{ i.city }}</div>
                                        {% if i.state != "Select State" %}<div>{{ i.state }}</div>{% endif %}
                                        <div>{{ i.pincode }}</div>
                                      </div>

                                      <span class="ms-auto text-muted small">{{ forloop.counter }}</span>
                                    </label>

                                  </div>
                                  {% endfor %}
                                </div>

                            </div>
                        </div>
                    </div>



                        <div id="addAddressModal" class="modal">
                        <div class="modal-content">
                        <span class="close" onclick="closeAddAddressModal()">&times;</span>
                        <h2>Add Address</h2>
                        <form id="addAddressForm" onsubmit="saveAddress(event)" action="/add_address/" method="post">{% csrf_token %}

                            <div class="col-12 d-flex main_flex_div">
                            <div class="col-4 d-flex flex-column inner_flex_div">
                                <label for="fname">First Name:</label>
                            <input type="text" id="fname" name="fname" required><br>
                            </div>

                            <div class="col-4 d-flex flex-column inner_flex_div">
                            <label for="sname">Second Name:</label>
                            <input type="text" id="sname" name="sname" required><br>
                            </div>

                            <div class="col-4 d-flex flex-column inner_flex_div">
                                <label for="mobile">Mobile No.:</label>
                            <input type="tel" id="mobile" name="phone" required pattern="[0-9]{10}"><br>
                            </div>
                            </div>
                            <div class="col-12 d-flex main_flex_div">

                            <div class="col-4 d-flex flex-column inner_flex_div">
                            <label for="email">Email ID:</label>
                            <input type="email" id="email" name="email" required>
                            </div>

                            <div class="col-4 d-flex flex-column inner_flex_div">
                                 <label for="pincode">Pin code:</label>
                            <input type="text" id="pincode" name="pincode" required><br>

                            </div>
                            </div>


                             <div class="col-12 d-flex main_flex_div">


                            <div class="col-4 d-flex flex-column inner_flex_div">
                               <label for="city">City/District/Town:</label>
                            <input type="text" id="city" name="city" required><br>

                            </div>

                            <div class="col-4 d-flex flex-column inner_flex_div">
                               <label for="state">State:</label>
                            <select id="state" name="state" required>
                                <option value="">Choose...</option>
                                <option>Thiruvanathapuram</option>
                                <option>Kollam</option>
                                <option>Pathanamthitta</option>
                                <option>Alappuzha</option>
                                <option>Kottayam</option>
                                <option>Idukki</option>
                                <option>Ernakulam</option>
                                <option>Thrissure</option>
                                <option>Palakkad</option>
                                <option>Malappuram</option>
                                <option>Kozhikode</option>
                                <option>Wayanad</option>
                                <option>Kannoor</option>
                                <option>Kasargod</option>
                            </select><br>
                            </div>

                            </div>

                             <div class="col-12 d-flex main_flex_div">
                            <div class="col-12 d-flex flex-column inner_flex_div">
                                <label for="address">Address:</label>
                             <textarea id="address" name="address" required></textarea><br>
                            </div>

                            </div>


                             <div class="col-12 d-flex main_flex_div">
                            <div class="col-6 d-flex flex-column inner_flex_div">
                                  <label for="landmark">Landmark (Optional):</label>
                            <input type="text" id="landmark" name="landmark"><br>

                            </div>


                            </div>

                             <div class="col-12 d-flex button_div">
                             <button type="submit">Save</button>
                            <button type="button" onclick="closeAddAddressModal()">Cancel</button>
                            </div>


                        </form>
                    </div>
                </div>

                        <div id="reviewModal" class="modal" style="display:none;">
                          <div class="modal-content">
                            <span class="close" onclick="closeReviewModal()">&times;</span>
                            <h4>Add Review</h4>

                            <form method="post" action="/add_review/" enctype="multipart/form-data">
                              {% csrf_token %}
                              <input type="hidden" name="product_id" id="reviewProductId">

                              <!-- Images -->
                              <label>Upload Images (2 max)</label><br><br>
                              <input type="file" name="img1" accept="image/*" required><br><br>
                              <input type="file" name="img2" accept="image/*"><br><br>

                              <!-- Stars -->
                              <label>Rating</label>
                              <div id="stars">
                                <span onclick="setRating(1)">â˜…</span>
                                <span onclick="setRating(2)">â˜…</span>
                                <span onclick="setRating(3)">â˜…</span>
                                <span onclick="setRating(4)">â˜…</span>
                                <span onclick="setRating(5)">â˜…</span>
                              </div>
                              <input type="hidden" name="rating" id="ratingInput" required><br><br>

                              <!-- Review -->
                              <label>Review</label>
                              <textarea name="review" rows="4" required></textarea>

                              <div class="col-12 d-flex button_div">
                                <button type="submit">Submit</button>
                                <button type="button" onclick="closeReviewModal()">Cancel</button>
                              </div>
                            </form>
                          </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

          <script>

           function showAddAddressModal() {
        const modal = document.getElementById('addAddressModal');
        modal.style.display = 'block';
        isFormVisible = true;
    }

    function closeAddAddressModal() {
        const modal = document.getElementById('addAddressModal');
        modal.style.display = 'none';
        isFormVisible = false;
    }

    function openReviewModal(productID) {
      document.getElementById("reviewProductId").value = productID;
      document.getElementById("reviewModal").style.display = "block";
    }

    function closeReviewModal() {
      document.getElementById("reviewModal").style.display = "none";
    }

    function setRating(n) {
      document.getElementById("ratingInput").value = n;
      const stars = document.querySelectorAll("#stars span");
      stars.forEach((s, i) => {
        s.classList.toggle("active", i < n);
      });
    }


        function showProfileDetails() {
            hideAllSections();
            document.getElementById('profileDetails').style.display = 'block';
            setActiveLink(0);
        }

        function showOrderDetails() {
            hideAllSections();
            document.getElementById('orderDetails').style.display = 'block';
            setActiveLink(1);
        }

        function showAccountDetails() {
            hideAllSections();
            document.getElementById('accountDetails').style.display = 'block';
            setActiveLink(2); // adjust index if needed
        }

        function showAddressBook() {
            hideAllSections();
            document.getElementById('addressBook').style.display = 'block';
            setActiveLink(3);
        }

        function hideAllSections() {
            document.getElementById('orderDetails').style.display = 'none';
            document.getElementById('profileDetails').style.display = 'none';
            document.getElementById('addressBook').style.display = 'none';
            document.getElementById('accountDetails').style.display = 'none';
        }

        function setActiveLink(index) {
            const current = document.querySelector('.list-group-item.active');
            if (current) current.classList.remove('active');
            document.querySelectorAll('.list-group-item')[index].classList.add('active');
        }

        showProfileDetails();
    </script>

</body>

</html>